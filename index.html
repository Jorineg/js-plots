<!DOCTYPE html>
<html>

<head>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>

    <style>
        #text-container {
            font-family: monospace;
            line-height: 1.5em;
            font-size: 1.5em;
            margin-bottom: 20px;
        }
    </style>
</head>

<body>
    <div style="margin: 0 auto; max-width: 1000px;">
        <div id="text-container"></div>
        <div id="chart-container"></div>
    </div>
    <!-- upper rigth corner floating switch -->
    <div id="switch"
        style="position: fixed; top: 10px; right: 10px; background-color: white; padding: 10px; border-radius: 5px; box-shadow: 0 0 5px rgba(0, 0, 0, 0.1); z-index: 100;">
        <label>
            <input type="checkbox" id="switch-checkbox" onclick="paddingToggle(this)" checked>
            Show padding tokens
        </label>
        <script src="NewVisualization.js"></script>
        <script>

            function compressText(text) {
                const compressed = pako.deflate(text);
                return btoa(String.fromCharCode.apply(null, compressed))
                    .replace(/\+/g, '-')
                    .replace(/\//g, '_')
                    .replace(/=/g, '');
            }

            function decompressText(compressedText) {
                const padding = '='.repeat((4 - (compressedText.length % 4)) % 4);
                const base64 = (compressedText + padding).replace(/-/g, '+').replace(/_/g, '/');
                const charData = atob(base64).split('').map(x => x.charCodeAt(0));
                const inflated = pako.inflate(new Uint8Array(charData));
                return new TextDecoder().decode(inflated);
            }

            // load json from url data=json
            var url = new URL(window.location.href);
            var data = url.searchParams.get("data");
            var showPadding = true

            try {
                var jsonData = JSON.parse(data);
            } catch (e) {
                data = decompressText(data);
                var jsonData = JSON.parse(data);
            }
            const textColors = jsonData.textColors;
            const tokens = jsonData.tokens;
            const metrics = jsonData.metrics;

            function redraw() {
                d3.select("#chart-container").selectAll("*").remove();
                d3.select("#text-container").selectAll("*").remove();
                createVisualization(textColors, tokens, metrics, showPadding);
            }

            redraw();

            window.addEventListener('resize', () => {
                redraw();
            });

            function paddingToggle(checkbox) {
                showPadding = checkbox.checked;
                redraw();
            }
        </script>
</body>

</html>