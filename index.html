<!DOCTYPE html>
<html>

<head>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>

    <style>
        #text-container {
            font-family: monospace;
            line-height: 1.5em;
            font-size: 1.5em;
            margin-bottom: 20px;
        }
    </style>
</head>

<body>
    <div style="margin: 0 auto; max-width: 1000px;">
        <div id="text-container"></div>
        <div id="chart-container"></div>
    </div>
    <script src="NewVisualization.js"></script>
    <script>
        // const textColors = ["rgb(167, 219, 51)", "rgb(54, 90, 140)", "rgb(94, 201, 97)", "rgb(141, 214, 68)", "rgb(75, 194, 108)", "rgb(35, 135, 141)", "rgb(129, 211, 76)", "rgb(67, 58, 131)", "rgb(50, 99, 141)", "rgb(202, 224, 30)", "rgb(31, 148, 139)", "rgb(241, 229, 28)", "rgb(30, 153, 138)", "rgb(72, 30, 112)", "rgb(61, 187, 116)", "rgb(72, 30, 112)", "rgb(149, 215, 63)", "rgb(31, 161, 135)"];
        // const tokens = ["This", "is", "a", "sample", "text", "for", "visualization.", "It", "contains", "multiple", "sentences.", "You'd", "use", "a", "proper", "tokenizer", "in", "practice."];
        // const metrics = [{"predicted_return": [0.870479046841575, 0.2820288376319082, 0.7500078549442541, 0.828861302579092, 0.7163043489181429, 0.4622689454738603, 0.8108165477516402, 0.16807664861307725, 0.31825668710218036, 0.9183052137598521, 0.518566109317767, 0.9789543515479193, 0.5419688663165733, 0.08493484601779444, 0.6854241677899462, 0.0858758533454026, 0.8425044913081823, 0.5707021742140328], "actual_return": [0.7396707971280218, 0.51880746455005, 0.39255165848312545, 0.5058130544647257, 0.6182606068058849, 0.38707917604270725, 0.8503464690476379, 0.11934530426318501, 0.2509597766308507, 0.1961821207322676, 0.06922446658162562, 0.349583767500003, 0.6705452993198692, 0.053914412084258956, 0.8465766136143416, 0.2301103485558439, 0.22192747860421747, 0.35602425588806264]}, {"reward": [-2.119298624538261, 1.5554941567200997, -0.1713444516344198, 1.831142625084956, 0.24628308586853442, -1.0912809488556934, 1.6898788898460055, 1.7096061569220327, 0.07742729130982173, -1.9002110938960326, -1.4636151054935886, 2.1973850378167437, -1.8707423950438433, 0.3167165693636004, 0.7250011216382829, -1.1737782693307564, -0.15255804260723815, 1.4507016369828714]}];

        function compressText(text) {
            const compressed = pako.deflate(text);
            return btoa(String.fromCharCode.apply(null, compressed))
                .replace(/\+/g, '-')
                .replace(/\//g, '_')
                .replace(/=/g, '');
        }

        function decompressText(compressedText) {
            const padding = '='.repeat((4 - (compressedText.length % 4)) % 4);
            const base64 = (compressedText + padding).replace(/-/g, '+').replace(/_/g, '/');
            const charData = atob(base64).split('').map(x => x.charCodeAt(0));
            const inflated = pako.inflate(new Uint8Array(charData));
            return new TextDecoder().decode(inflated);
        }

        // load json from url data=json
        var url = new URL(window.location.href);
        var data = url.searchParams.get("data");
        data = decompressText(data);
        var jsonData = JSON.parse(data);
        const textColors = jsonData.textColors;
        const tokens = jsonData.tokens;
        const metrics = jsonData.metrics;

        createVisualization(textColors, tokens, metrics);
    </script>
</body>

</html>