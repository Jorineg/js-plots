<!DOCTYPE html>
<html>

<head>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>

    <style>
        #text-container {
            font-family: monospace;
            line-height: 1.5em;
            font-size: 1.5em;
            margin-bottom: 20px;
        }
    </style>
</head>

<body>
    <div style="margin: 0 auto; max-width: 1000px;">
        <div id="text-container"></div>
        <div id="chart-container"></div>
    </div>
    <script src="NewVisualization.js"></script>
    <script>

        function compressText(text) {
            const compressed = pako.deflate(text);
            return btoa(String.fromCharCode.apply(null, compressed))
                .replace(/\+/g, '-')
                .replace(/\//g, '_')
                .replace(/=/g, '');
        }

        function decompressText(compressedText) {
            const padding = '='.repeat((4 - (compressedText.length % 4)) % 4);
            const base64 = (compressedText + padding).replace(/-/g, '+').replace(/_/g, '/');
            const charData = atob(base64).split('').map(x => x.charCodeAt(0));
            const inflated = pako.inflate(new Uint8Array(charData));
            return new TextDecoder().decode(inflated);
        }

        // load json from url data=json
        var url = new URL(window.location.href);
        var data = url.searchParams.get("data");
        try {
            var jsonData = JSON.parse(data);
        } catch (e) {
            data = decompressText(data);
            var jsonData = JSON.parse(data);
        }
        const textColors = jsonData.textColors;
        const tokens = jsonData.tokens;
        const metrics = jsonData.metrics;

        createVisualization(textColors, tokens, metrics);
    </script>
</body>

</html>